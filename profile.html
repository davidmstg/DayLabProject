<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayLab | My Profile</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="loadProfile()">

    <header class="container">
        <nav>
            <a href="index.html" style="display: block; border: none; text-decoration: none;">
                <img src="logo1.png" alt="DayLab Logo" style="height: 50px; width: auto; mix-blend-mode: multiply; display: block;">
            </a>
            <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="bloodtest.html">Bloodtest</a></li>
                <li><a href="about.html">About Us</a></li>
                </ul>
        </nav>
    </header>

    <main class="container">
        <section class="text-center" style="padding: 60px 0 20px;">
            <h1>Personal Cabinet</h1>
            <p>Manage your health data and view history.</p>
        </section>

        <div style="display: flex; gap: 30px; flex-wrap: wrap; margin-bottom: 100px;">
            
            <div class="card medical-form" style="flex: 1; min-width: 350px;">
                <div class="card-header"><h3>Account Information</h3></div>
                <div style="padding: 20px 25px;">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" id="prof-email" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label>Diet</label>
                        <select id="prof-diet">
                            <option value="vegan">Vegan</option>
                            <option value="dairy-free">Dairy-Free</option>
                            <option value="pregnancy">Pregnancy-Friendly</option>
                            <option value="standard">Standard</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;"><label>Height</label><input type="number" id="prof-height"></div>
                        <div class="form-group" style="flex: 1;"><label>Weight</label><input type="number" id="prof-weight"></div>
                    </div>
                    <button onclick="updateProfile()" class="btn-main" style="width: 100%; margin: 10px 0;">Save Changes</button>
                </div>
            </div>

            <div class="card" style="flex: 2; min-width: 350px; border: 1px solid var(--gray-border);">
                <div class="card-header" style="background: var(--accent-red); color: white; padding: 15px 25px;">
                    <h3 style="margin:0">Test History</h3>
                </div>
                <div id="history-list" style="padding: 20px;">
                    <p style="color: #666; font-style: italic;">No previous tests found.</p>
                </div>
            </div>

        </div>
    </main>

    <footer class="text-center"><p>&copy; 2025 DayLab Project</p></footer>

    <script src="script.js"></script>
    <script>
        // Specific logic for Profile Page
        function loadProfile() {
            const user = JSON.parse(localStorage.getItem('daylabUserProfile'));
            if (user) {
                document.getElementById('prof-email').value = user.email || "";
                document.getElementById('prof-diet').value = user.diet || "standard";
                document.getElementById('prof-height').value = user.height || "";
                document.getElementById('prof-weight').value = user.weight || "";
            }
            renderHistory();
        }

        function updateProfile() {
            const user = JSON.parse(localStorage.getItem('daylabUserProfile')) || {};
            user.diet = document.getElementById('prof-diet').value;
            user.height = document.getElementById('prof-height').value;
            user.weight = document.getElementById('prof-weight').value;
            
            localStorage.setItem('daylabUserProfile', JSON.stringify(user));
            alert("Profile updated!");
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('bloodTestHistory')) || [];
            const container = document.getElementById('history-list');
            if (history.length === 0) return;

            container.innerHTML = history.map((test, index) => `
                <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Test #${history.length - index}</strong><br>
                        <small style="color: #888;">Date: ${test.date}</small>
                    </div>
                    <button onclick="viewOldTest(${index})" class="btn-outline" style="margin: 0;">View Results</button>
                </div>
            `).join('');
        }

        function viewOldTest(index) {
            const history = JSON.parse(localStorage.getItem('bloodTestHistory'));
            localStorage.setItem('userResults', JSON.stringify(history[index].data));
            window.location.href = 'results.html';
        }
    </script>
</body>
</html>